<div class="flex justify-start flex-wrap border-green-700 w-[100%] mt-0 mb-8">
    <% if scraped_data.present? %>
        <% scraped_data.each_with_index do |data, index| %>
            <div class="hidden">
                <p id="contentWebsite"><%= data[:website] %></p>
                <p id="contentUrl"><%= data[:url] %></p>
            </div>
            
            <div class="<%= Time.now - data.created_at <= 60 && 'rounded-md p-1 !bg-green-100' %>">
                
                <div class="mb-5 relative border border-grey-700 w-min-[242px] w-max-[381px] w-[200px] h-[320px] m-1 overflow-hidden rounded-sm shadow-md">
                    
                    
                    <span 
                        type="button" 
                        class="absolute top-3 left-2 inline-flex items-center text-white bg-red-600 hover:bg-red-700 focus:ring-4 focus:outline-none focus:ring-red-300 font-medium rounded-lg text-[10px] px-2 py-1.5 text-center cursor-pointer">
                        <%= button_to "", gumtree_scrape_path(data), method: :delete%>
                        <svg aria-hidden="true" class="w-4 h-4 -ml-1" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd"></path></svg>
                        
                    </span> 
                    
                    <a 
                        target="_blank"
                        href="/gumtree_scrapes/<%= data[:id] %>/edit"
                        type="button" class="absolute top-3 right-2 text-white inline-flex items-center bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-primary-300 font-small rounded-lg text-[10px] px-2 py-1.5  text-center">
                        <svg aria-hidden="true" class="mr-1 -ml-1 w-3 h-3" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z"></path><path fill-rule="evenodd" d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clip-rule="evenodd"></path></svg>
                        Edit
                    </a> 
                    <a
                        target="_blank"
                         <%# href="/gumtree_scrapes/= data[:id]/edit"    %>
                        href="<%= data[:link] %>"
                    <%# href="data[:link_src] " %>
                    >
                        <% if data[:link_src] != "" %>
                            <img id="img_src_id" src="<%= data[:link_src] %>"  class="w-[100%] rounded-sm h-[200px]"/>
                        <% else %>
                            <%= image_tag "fridge-img.jpg", alt: 'fridge-img.jpg', class: "w-[100%] rounded-sm h-[200px]" %> 
                        <%end %>
                        <span class="text-[12px]" id="price_id"><strong><%= data[:price] %></strong></span><br>
                        <p class="text-[11px] mb-0 pb-0" id="title_id"><%= data[:title].slice(0, 28) %></p>
                        <p class="text-[10px] mb-0 mt-1 pb-2" id="description_id"><%= data[:description].slice(0, 50) %></p>
                        <div class="relative text-ellipsis whitespace-nowrap overflow-hidden text-[10px] mt-2 flex justify-between">
                            <p id="location_id" class="text-[8px]"><%= data[:location] %> </p> 
                            <button><a class="text-[10px] text-white bg-blue-700" target="_blank" id="link_id" href="<%= data[:link] %>">Gumtree Post</a></button>
                        </div><br>
                    </a>
                </div>
            </div>
        <%end %>
    <% end %>
</div>



<script>
    clicked_input = []
    function selected_input(){
        const input_array = document.querySelectorAll('#input')

        input_array.forEach(element => {
            element.addEventListener('click', () => {
                const id = document.getElementById('data_id')
                const title = document.getElementById('title_id')
                const price = document.getElementById('price_id')
                const description = document.getElementById('description_id')
                const location = document.getElementById('location_id')
                const img_src = document.getElementById('img_src_id')
                const link = document.getElementById('link_id')

                const website = document.getElementById('contentWebsite')
                const url = document.getElementById('contentUrl')
                
                clicked_input.push({
                    'title': title.outerText,
                    'price': price.outerText,
                    'description': description.outerText,
                    'location': location.outerText,
                    "img": img_src.currentSrc,
                    "link": link.href,
                    'website': website.outerText,
                    'url': url.outerText
                })
            });
        });
        // saveItem()
    }
    function handle_price_increase(){
        const selectedInputBtn = document.getElementById('useSelectedInput')

        clicked_input.forEach(() => {

        })
    }


    function handle_selected_input(){
        const selectedInputBtn = document.getElementById('useSelectedInput')

        selectedInputBtn.addEventListener('click', () => {
            use_clicked_input()
        })
    }


    function use_clicked_input() {
        const jsonString = JSON.stringify(clicked_input);
        const formattedJsonString = jsonString.replace(/,(?=\s*"[^"]+":)/g, ',\n');
        const lines = formattedJsonString.split('\n');

        // Open a new window with the JSON content
        const windowName = 'popupWindow';
        const windowFeatures = 'width=400,height=300,scrollbars=yes';

        const newWindow = window.open(" ", windowName, windowFeatures);

        newWindow.focus();

        newWindow.resizeTo(900, 700);
        newWindow.document.write('<pre style="font-family: monospace; font-size: 12px; padding: 10px;">');

        lines.forEach(line => {
            newWindow.document.write(line + '\n');
        });
        newWindow.document.write('</pre>');
    }

    handle_selected_input()   
    selected_input()
</script>

            

